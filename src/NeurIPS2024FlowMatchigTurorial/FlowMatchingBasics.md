


P1     
# Flow Matching Basics

P6    
WHAT IS FLOW MATCHING?       
A scalable method to train **flow generative models**.      

HOW DOES IT WORK?      
Train by regressing a **velocity**, sample by following the **velocity**      

P8    
## The Generative Modeling Problem

![](../assets/P8å›¾.png)   

> æ­£æ–¹å½¢ä»£è¡¨æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€æ‰€æ„æˆçš„ç©ºé—´ï¼Œå³å›¾åƒç©ºé—´ã€‚æ­£æ–¹å½¢ä¸­çš„æ¯ä¸ªç‚¹ä»£è¡¨ä¸€ä¸ªsampleï¼Œå³ä¸€å¼ å›¾åƒã€‚      
\\(P\\) æ˜¯æºåˆ†å¸ƒï¼Œ\\(Q\\) æ˜¯ç›®æ ‡åˆ†å¸ƒã€‚     
\\(X_0\\) å’Œ \\(X_1\\)åˆ†åˆ«æ˜¯ \\(P\\) åˆ†å¸ƒå’Œ \\(Q\\) åˆ†å¸ƒä¸­çš„ sampleï¼     
**ç”Ÿæˆæ¨¡å‹çš„ç›®æ ‡æ˜¯ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ä» \\(P\\) ä¸­ sample åˆ° \\(Q\\) ä¸­ sample çš„æ˜ å°„**ã€‚    

P9     
### ç”Ÿæˆæ¨¡å‹çš„èŒƒå¼

> ç”Ÿæˆæ¨¡å‹æœ‰ä¸¤å¤§ç±»èŒƒå¼ï¼šç›´æ¥ç”Ÿæˆå’Œå¢é‡ç”Ÿæˆã€‚     
GAN å±äºç¬¬ä¸€å¤§ç±»ç”Ÿæˆæ¨¡å‹ï¼Œä¼˜ç‚¹æ˜¯å¿«ï¼Œå› ä¸ºå®ƒçš„ç”Ÿæˆè¿‡ç¨‹åªéœ€è¦ä¸€ä¸ªforwardã€‚ç¼ºç‚¹æ˜¯ï¼ˆ1ï¼‰æ²¡æœ‰ä¸€ä¸ªç²¾ç¡®çš„å¯ä»¥ç”¨äº sample çš„æ¦‚ç‡æ¨¡å‹ï¼ˆ2ï¼‰éš¾ä»¥è®­ç»ƒã€‚     

P10    

> å¢é‡ç”Ÿæˆæ˜¯å¦ä¸€ç§ç”ŸæˆèŒƒå¼ï¼Œä¸æ˜¯ç›´æ¥ç”Ÿæˆæœ€ç»ˆç»“æœï¼Œè€Œæ˜¯é€æ­¥ç”Ÿæˆã€‚æ¯ä¸€æ¬¡ç”Ÿæˆæ¯”ä¸Šä¸€æ¬¡è¦å¥½ã€‚

![](../assets/P10å›¾2.png)

> Flow çš„è½¬ç§»è¿‡ç¨‹æ˜¯å¹³æ»‘çš„ã€‚Diffusion æ˜¯è¿ç»­ä½†ä¸å¹³æ»‘çš„ã€‚è¿˜æœ‰ä¸€äº›æ˜¯ä¸è¿ç»­çš„ï¼Œä½†éƒ½æ˜¯åŸºäºè¿ç»­æ—¶é—´é©¬å°”å¯å¤«è¿‡ç¨‹çš„éšæœºè¿‡ç¨‹Continuous-time Markov processã€‚      

![](../assets/P10å›¾1-0.png)

> \\(\Phi\\) æ˜¯ä»ä¸€æ¬¡ç”Ÿæˆåˆ°å¦ä¸€æ¬¡ç”Ÿæˆçš„è½¬ç§»å‡½æ•°ã€‚    
**å¢é‡ç”Ÿæˆæ¨¡å‹çš„ç›®æ ‡æ˜¯å­¦ä¹ è½¬ç§»å‡½æ•°**ã€‚      

P11    

### Marginal probability path

è¾¹ç¼˜æ¦‚ç‡è·¯å¾„æ˜¯æŒ‡ï¼Œä»»æ„ä¸€ä¸ªç‰¹å®šçš„ \\(t\\) æ—¶åˆ»ï¼Œ\\(X_t\\) æ‰€å±äºçš„åˆ†å¸ƒ \\(p_t\\)ã€‚ å³è¿ç»­æ—¶é—´ä¸Šçš„åˆ†å¸ƒç°‡ã€‚    

![](../assets/P11å›¾-1.png)

> **ç”Ÿæˆæ¨¡å‹æœ€é‡è¦çš„æ˜¯ï¼Œè¾¹ç¼˜æ¦‚ç‡è·¯å¾„ä»¥ \\(P\\) åˆ†å¸ƒå¼€å§‹ï¼Œä»¥ \\(Q\\) åˆ†å¸ƒç»“æŸ**ã€‚     

P12   
### ä¸‰ç§å¢é‡ç”Ÿæˆæ¨¡å‹çš„ç‰¹ç‚¹   

![](../assets/P12-1å›¾.png)

> æµçš„ç‰¹ç‚¹ï¼š(1) ç¡®å®šæ€§ï¼Œå·²çŸ¥ \\(X_t\\)ï¼Œé‚£ä¹ˆ \\(X_{t+h}\\) æ˜¯ç¡®å®šçš„ã€‚(2) å¹³æ»‘       
æµçš„ä¼˜åŠ¿ï¼š(1) sample é€Ÿåº¦å¿« (2) å¯ä»¥æ„å»ºæ¨¡å‹ä¼¼ç„¶çš„æ— åä¼°è®¡å™¨ã€‚      
Diffusion å’Œ Jump å…·æœ‰æ›´å¤§çš„è®¾è®¡ç©ºé—´ï¼Œå› æ­¤å…·æœ‰æ›´å¤šç”Ÿæˆèƒ½åŠ›ã€‚    

P13    
## Flow ç”Ÿæˆæ¨¡å‹   

### Flow çš„å‚æ•°åŒ– 

![](../assets/P13å›¾-1.png)

> \\(\Psi_t\\) æ˜¯ flow ç”Ÿæˆæ¨¡å‹çš„è½¬ç§»å‡½æ•°ã€‚    
\\(\Psi_t\\) æ˜¯ä¸€ä¸ªåŒå°„å‡½æ•°ï¼Œå› æ­¤å®ƒå¯ä»¥é‡å¡‘ç©ºé—´è€Œä¸ä¸¢å¤±ä¿¡æ¯ã€‚    
é€šè¿‡å¯¹é«˜ç»´ç©ºé—´çš„ warpingï¼Œä½¿ \\(P\\) åˆ†å¸ƒé€æ­¥å˜ä¸º \\(Q\\) åˆ†å¸ƒã€‚  
**åŒå°„å‡½æ•°**çš„ç‰¹æ€§ï¼š
- **ä¸€ä¸€å¯¹åº”**ï¼šæ¯ä¸ªè¾“å…¥å¯¹åº”å”¯ä¸€çš„è¾“å‡ºï¼Œä¸”æ¯ä¸ªè¾“å‡ºéƒ½è¢«æŸä¸ªè¾“å…¥æ˜ å°„åˆ°ã€‚
- **å¯é€†æ€§**ï¼šå­˜åœ¨é€†å‡½æ•° \\( f^{-1}: Y \to X \\)ï¼Œæ»¡è¶³ \\( f^{-1}(f(x)) = x \\) ä¸” \\( f(f^{-1}(y)) = y \\)ã€‚

![](../assets/P13å›¾-2.png)

> flow Model æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ã€‚   
é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆMarkov Processï¼‰æ˜¯ä¸€ç±»å…·æœ‰**æ— è®°å¿†æ€§**ï¼ˆé©¬å°”å¯å¤«æ€§è´¨ï¼‰çš„éšæœºè¿‡ç¨‹ï¼Œå…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯**æœªæ¥çŠ¶æ€ä»…ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œè€Œä¸å†å²çŠ¶æ€æ— å…³**ã€‚

#### ç›´æ¥å‚æ•°åŒ–ä¼šé‡åˆ°çš„é—®é¢˜  

> å¯¹ä¸¤ä¸ªåŒå°„å‡½æ•°åšçº¿æ€§ç»„åˆï¼Œå¾—åˆ°çš„å‡½æ•°ä¸èƒ½ä¿æŒå…¶åŒå°„çš„ç‰¹æ€§ï¼Œå› æ­¤ï¼ŒåŸºäºåŒå°„å‡½æ•°çš„æ¨¡å‹éš¾ä»¥è¢«å‚æ•°åŒ–ã€‚

$$
\alpha X_ {t|1}+\beta X_ {t|2}\ne \Psi _ t(\alpha X_ {t|1}+\beta X_ {t|2})
$$

> ç½‘ç»œæ¨¡å‹ä¸­é€šå¸¸åŒ…å«å¤§é‡çº¿æ€§ç»„åˆï¼Œæ¿€æ´»å‡½æ•°ç­‰ä¼šç ´ååŒå°„æ€§çš„ç»“æ„ï¼Œå› æ­¤å¾ˆéš¾è®©ç½‘ç»œå­¦åˆ°ä¸€ä¸ªåŒå°„å‡½æ•°ã€‚     
â€œæ¨¡å‹çš„å‚æ•°åŒ–â€ï¼ˆ**Parameterization of a Model**ï¼‰æ˜¯æŒ‡**ç”¨ä¸€ç»„å¯è°ƒæ•´çš„å‚æ•°ï¼ˆParametersï¼‰æ¥å®šä¹‰æ¨¡å‹çš„ç»“æ„å’ŒåŠŸèƒ½**çš„è¿‡ç¨‹ã€‚å®ƒæ˜¯æ¨¡å‹è®¾è®¡çš„æ ¸å¿ƒæ­¥éª¤ï¼Œå†³å®šäº†æ¨¡å‹å¦‚ä½•ä»è¾“å…¥æ•°æ®ä¸­å­¦ä¹ è§„å¾‹ã€è¿›è¡Œé¢„æµ‹æˆ–ç”Ÿæˆè¾“å‡ºã€‚åŒ…æ‹¬ï¼ˆè®¾è®¡æ¨¡å‹ç»“æ„ã€è¿æ¥æ–¹å¼ï¼Œå®šä¹‰å‚æ•°å¦‚ä½•åˆå§‹åŒ–ï¼Œå“ªäº›å‚æ•°å¯ä»¥è¢«ä¼˜åŒ–ï¼‰ã€‚   

P14     
#### åˆ©ç”¨é€Ÿåº¦å¯¹æµåšå‚æ•°åŒ–      

> å› æ­¤åˆ©ç”¨é€Ÿåº¦å¯¹æµåšå‚æ•°åŒ–ã€‚åœ¨è¿™é‡Œï¼Œé€Ÿåº¦æ˜¯æŒ‡ \\(P_t\\) åˆ†å¸ƒä¸­çš„æ¯ä¸ª sample å‘ \\(Q\\) åˆ†å¸ƒä¸­å¯¹åº” sample å˜åŒ–çš„é€Ÿåº¦ï¼ˆå¿«æ…¢å’Œæ–¹å‘ï¼‰ã€‚    
Flow å’Œ velocity æ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ã€‚å¯¹ Flow åšå¾®åˆ†å¯ä»¥å¾—åˆ° velocityï¼Œå¯¹ velocily è§£å¸¸å¾®åˆ†æ–¹ç¨‹ï¼Œå¯ä»¥å¾—åˆ° Flow.    

![](../assets/P14å›¾1.png)    

> ä½¿ç”¨é€Ÿåº¦çš„å¥½å¤„ï¼šé€Ÿåº¦æ˜¯çº¿æ€§çš„ï¼Œå¯ä»¥ç›¸åŠ æˆ–åˆ†è§£ï¼Œå› æ­¤å¯ä»¥å¯¹é€Ÿåº¦åšå‚æ•°åŒ–ã€‚       
ä½¿ç”¨é€Ÿåº¦çš„ç¼ºç‚¹ï¼šéœ€è¦å¯¹ sample å‡ºé€Ÿåº¦åš ODEï¼Œè§£å‡ºå›¾åƒã€‚   

$$
\frac{d}{dt} \Psi  _t(x)=u_t(\Psi _t(x))
$$

$$
\frac{d}{dt}\Psi  _t(\alpha X_1+\beta X_2)=\alpha u_t(\psi _t(X_1))+\beta u_t(\psi _t(X_2)) 
$$

P15    

Velocity \\(u_t\\) **generates** \\(p_t\\) if     

$$
X _t=\Psi _t(X_0)\sim p_t
$$


> ä½¿ç”¨é€Ÿåº¦æ¥å®šä¹‰è¾¹ç¼˜æ¦‚ç‡è·¯å¾„ï¼Œ\\(\Psi_t\\) æ˜¯åŸºäºé€Ÿåº¦çš„è½¬ç§»å‡½æ•°ã€‚   

P16        

#### Flow Matching çš„è®­ç»ƒ    
å­¦ä¹ ä¸€ä¸ªé€Ÿåº¦æ¨¡å‹ï¼Œç”±é€Ÿåº¦å¾—åˆ°è¾¹ç¼˜è·¯å¾„æ¦‚ç‡ \\(P_t\\)ï¼Œä½¿å¾— \\(P_0 = P\\)ï¼Œ \\(P_1= Q\\)     

P17    
#### Sampling a flow model

> Flow Matching çš„æ¨æ–­ï¼š    
(1) ä» \\(P\\) åˆ†å¸ƒä¸­ sample ä¸€ä¸ª noise      
(2) æ ¹éšé€Ÿåº¦ï¼ˆè§£ODEï¼‰å¾—åˆ°å¯¹åº”åœ¨ \\(Q\\) åˆ†å¸ƒä¸­çš„ sampleã€‚    

![](../assets/P17å›¾.png)    

$$
\frac{d}{dt} X_t=u^0_t(X_t)
$$

Use any ODE numerical solver.      
One that works well: **Midpoint**     



P19    
## Simplest version of Flow Matching 

### flow matching çš„è®­ç»ƒ    

(1) éšæœºæ„é€ æº \\(X_0\\) å’Œç›®æ ‡ \\(X_1\\)ã€‚     
(2) åœ¨ [0ï¼Œ1] åŒºé—´éšæœºé‡‡æ ·ä¸€ä¸ªæ—¶é—´æ­¥ \\(t\\)ã€‚    
(3) \\(X_t\\) æ˜¯ \\(X_0\\) ä¸ \\(X_1\\) çš„çº¿æ€§ç»„åˆã€‚     
(4) \\(X_t\\) æ˜¯ç½‘ç»œè¾“å…¥ï¼Œè®©ç½‘ç»œè¾“å‡ºé€¼è¿‘\\(X_1-X_0\\)ã€‚    

![](../assets/P19å›¾1.png)    
![](../assets/P19å›¾2.png)    

$$
\mathbb{E } _{t,X_0,X_1}||u_t^0(X_t)-(X_1-X_0)||^2
$$


&#x1F50E; "Flow Matching for Generative Modeling" Lipman el al. (2022)      
&#x1F50E; "Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow" Liu et al. (2022)       
&#x1F50E; "Building Normalizing Flows with Stochastic Interpolants" Albergo et al. (2022)    

 

P20      

> è¿™é‡Œæ²¡æœ‰å¯¹ \\(X_0\\) å’Œ \\(X_1\\) æ‰€å±çš„åˆ†å¸ƒä½œé™åˆ¶ã€‚ \\(X_0\\) å’Œ \\(X_1\\) å¯ä»¥æ˜¯ç‹¬ç«‹çš„å™ªå£°å’Œå›¾åƒï¼Œä¹Ÿå¯ä»¥æ˜¯å…·æœ‰æŸç§å…³ç³»ï¼ˆä¾‹å¦‚é»‘ç™½ä¸å½©è‰²ï¼‰çš„ pair dataã€‚    

### Why does it work?      
â€¢ Build flow from conditional flows      
> å¦‚ä½•ä»ä¸€ä¸ªæ›´ç®€å•çš„é€Ÿåº¦æˆ–æµï¼ˆç§°ä¸ºæ¡ä»¶æµï¼‰æ„å»ºä¸€ä¸ªé€Ÿåº¦æˆ–æµã€‚æ¡ä»¶æµæ˜¯æŒ‡ä¸€äº›ç®€å•çš„ï¼Œå›ºå®šçš„éƒ¨åˆ†ã€‚      

â€¢ Regress conditional flows      

> é€šè¿‡è§‚å¯Ÿæ›´ç®€å•çš„æ¡ä»¶æµæ¥å­¦ä¹ å¤æ‚çš„éƒ¨åˆ†ã€‚

P21    
#### å±€éƒ¨é—®é¢˜   

> å‡è®¾ç›®æ ‡åˆ†å¸ƒåªæœ‰ \\(X_1\\) è¿™ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆæµå’Œé€Ÿåº¦æ˜¯è¿™æ ·çš„ã€‚    

![](../assets/P21å›¾.png)    

$$
X_t=\Psi _t(X_0|x_1)=(1-t)X_0+tx_1
$$

è¿™æ˜¯ä¸€ä¸ªæ¡ä»¶æµã€‚    
\\(p_{t|1}(x|x_1)\\) æ˜¯ conditional probability     
\\(u_t(x|x_1)\\) æ˜¯ conditional velocityï¼Œæ˜¯å¸¸æ•°ã€‚        

P22    
#### å…¨å±€é—®é¢˜   
  
> å®é™…çš„ \\(Q\\) åˆ†å¸ƒåŒ…å«å¾ˆå¤š \\(x_1\\) è¿™æ ·çš„ sampleï¼Œæ¯ä¸€ä¸ª sample éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ª conditionï¼Œå¾—åˆ°ä¸€ä¸ª \\(P_{t|æ¡ä»¶}\\) ï¼Œç»¼åˆæ‰€æœ‰ \\(P_{t|æ¡ä»¶}\\) å¾—åˆ°çš„ \\(p_t(X)\\) æ˜¯è¿™ \\(P_{t|æ¡ä»¶}\\) çš„æœŸæœ›ã€‚å¯ä»¥è¯æ˜ï¼Œ\\(p_t(X)\\) ä»¥ \\(P\\) å¼€å§‹ï¼Œä»¥ \\(Q\\) ç»“æŸã€‚å¯¹ \\(Q\\) åˆ†å¸ƒä¸­çš„æ‰€æœ‰çš„ \\(x_1\\)ï¼Œå¯¹ \\(U_t(X|X_1)\\) å–å¹³å‡ï¼Œå¾—åˆ°ç”Ÿæˆâ€œè¾¹ç¼˜æ¦‚ç‡è·¯å¾„â€çš„é€Ÿåº¦ã€‚  
\\(p_t(x)= \mathbb{E} _ {X_ 1}p_{t|1}(x|X_ 1)\\)       
\\(u_t(X)\\) ä¹Ÿå¯ä»¥ä»¥è¿™ç§æ–¹å¼å¾—å‡ºã€‚    

\\(u_t(x)=\mathbb{E} [u_t(X_t|X_1)|X_t=x]\\)    

è¿™ä¸ªé€Ÿåº¦åœºç§°ä¸ºè¾¹ç¼˜é€Ÿåº¦ã€‚   

P23    

Theorem*: The **marginal velocity** (è¾¹ç¼˜é€Ÿåº¦) generates the **marginal probability** path (è¾¹ç¼˜æ¦‚ç‡è·¯å¾„)ã€‚   

ä»¥ä¸Šå…¬å¼ä¸­çš„æœŸæœ›ï¼Œå®é™…å«ä¹‰æ˜¯â€œå¹³å‡â€ã€‚    

P24    
#### conditional loss  

ç›®æ ‡å‡½æ•°ï¼šå›å½’è¾¹ç¼˜é€Ÿåº¦åœºã€‚   

(1) ç›´æ¥å›å½’è¾¹ç¼˜é€Ÿåº¦åœº  

$$
â„’_{FM}(Î¸) = \mathbb{E}  _{t,X_t}||u^Î¸_t (X_t) âˆ’ u_t(X_t)||^ 2 
$$

å…¶ä¸­ï¼Œ\\(u_t(X_t)\\) æ˜¯é€šè¿‡è®¸å¤šæ•°æ®è®¡ç®—å‡ºçš„å‡å€¼(æ ¹æ®ä¸Šæ–‡ä¸­çš„å…¬å¼)ã€‚    
(2) å›å½’æ¡ä»¶é€Ÿåº¦   

$$
â„’_{CFM}(Î¸) = \mathbb{E}  _{t,X_1,X_t}||u^Î¸_t (X_t) âˆ’ u_t(X_t|X_1)||^ 2 
$$

**Theorem:** Losses are equivalent,     

$$
\nabla_Î¸â„’_{FM}(Î¸) = \nabla_Î¸â„’_{CFM}(Î¸)
$$
  
> ç»“è®ºï¼šä»…å›å½’æ¡ä»¶é€Ÿåº¦ï¼Œä¸ç›´æ¥å›å½’é€Ÿåº¦ç›¸åŒã€‚    
ä½¿ç”¨æ¡ä»¶åˆ†å¸ƒ(å…¬å¼ 2)ç›¸æ¯”äºå…¬å¼ 1 çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥é€ä¸ªæ ·æœ¬å»è®¡ç®—ï¼Œè€Œä¸éœ€è¦å¯¹æ•´ä¸ªæ•°é›†åšå¹³å‡ã€‚    

P25    
**Theorem:** Losses are equivalent **if** \\(D\\) is a **Bregman divergence**.      

> æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨ä»»æ„çš„ Bregman Divergence Loss \\((D(\cdot ,\cdot ))\\) æ•£åº¦ä»£æ›¿ \\(L2(||\cdot ,\cdot ||^2)\\)ï¼Œéƒ½èƒ½å¾—åˆ°ç›¸åŒç»“è®ºï¼ŒL2 Loss åªæ˜¯å…¶ä¸­ä¸€ç§ã€‚

P26      

![](../assets/P26å›¾.png)    

> å› ä¸ºè¦å­¦ä¹ çš„æ˜¯ä¸€ä¸ªâ€œæœŸæœ›â€ã€‚    

P27    
## How to choose \\(Ïˆ_t(x|x_1)\\)?      

### Optimal Transport minimizes Kinetic Energy    

åœ¨ä¸Šæ–‡ä¸­ï¼Œå®šä¹‰     

$$
Ïˆ _t(x|x_1)=tx_1+(1-t)x
$$

è¿™æ ·å®šä¹‰ï¼Œæ˜¯åŸºäºâ€œæœ€å°åŒ–åŠ¨èƒ½â€çš„è€ƒè™‘ã€‚    
> å¦‚æœæœ€å°åŒ–åŠ¨èƒ½ï¼Œèƒ½è®©è·¯å¾„å˜å¾—ç›´ï¼Œä¸”é€Ÿåº¦æ’å®šã€‚   
æ‰€ä»¥å°† \\(Ïˆ _t(X_0|X_1)\\) å®šä¹‰ä¸º \\(X_0\\) å’Œ \\(X_1\\) è¿çº¿ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œå…¶ä¸­ \\(X_0\\) å¯ä»¥æ˜¯ç©ºé—´ä¸­ä»»æ„ä¸€ç‚¹å®šä¹‰ä¸º \\(X\\) ã€‚ 

![](../assets/P29å›¾.png)    

> ç›´æ¥ä¼˜åŒ–åŠ¨èƒ½ä¸å®¹æ˜“ï¼Œå› ä¸ºå®ƒä¸ä¾èµ–äºå…·ä½“çš„æ¡ä»¶ã€‚å› æ­¤ç»™å®ƒè®¾å®šä¸€ä¸ª Jensen boundï¼Œæ¥é™åˆ¶è¾¹ç¼˜é€Ÿåº¦çš„åŠ¨èƒ½ã€‚    

![](../assets/P27å›¾1.png)    

Jensen bound æ˜¯å…·ä½“çš„æ¡ä»¶ \\((X_0,X_1)\\) ä¸‹çš„æœŸæœ›ã€‚   
å½“ \\(X_0\\) å’Œ \\(X_1\\) ç¡®å®šæ—¶ï¼ŒJensen bound å¯ä»¥è¢«ç®—å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥(é€šè¿‡ä¼˜åŒ–\\(Ïˆ _t\\))è¢«æœ€å°åŒ–ã€‚    

**ç»“è®ºï¼š** å½“ \\(Ïˆ _t(x|x_1)\\) å®šä¹‰ä¸º \\(tX_1+(1-t)X\\) æ—¶ï¼ŒJensen bound è¢«æœ€å°åŒ–ï¼Œæ­¤æ—¶ \\(X_0\\) åˆ° \\(X_1\\) æ˜¯ç›´çº¿ã€‚   

**Linear conditional flowæ€»ç»“:**      
â€¢ Minimizes boundï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼˜åŒ–åŠ¨èƒ½ã€‚      
â€¢ Reduces Kinetic Energy of initial coupling      
æŠŠ \\(Ïˆ _t\\) ä»£å…¥ Jensen bound å…¬å¼å¯å¾—å‡ºæ­¤ç»“è®ºã€‚   

â€¢ Exact Optimal Transport for single data points     
å¦‚æœ \\(Q\\) åˆ†å¸ƒä¸­åªæœ‰ä¸€ä¸ª \\(X_1\\)ã€‚æ­¤æ—¶å…¬å¼å·¦å³ä¸¤è¾¹ç›¸ç­‰ï¼Œæ˜¯æœ€ä¼˜ä¼ è¾“ã€‚  

â€¢ <u>**Not**</u> Optimal Transport (but in high dim straighter)      
å¦‚æœ \\(Q\\) åˆ†å¸ƒé‡Œä¸æ­¢ä¸€ä¸ªç‚¹ï¼Œä¸æ˜¯æœ€ä¼˜ä¼ è¾“ï¼Œ\\(X_0\\) åˆ° \\(X_1\\) ä¹Ÿä¸æ˜¯ç›´çº¿ã€‚   

&#x1F50E; "Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow" Liu et al. (2022)      
&#x1F50E; "On Kinetic Optimal Probability Paths for Generative Models" Shaul et al. (2023)     
   

P29    
å¥½çš„æœ€ä¼˜ä¼ è¾“ï¼Œå¯ä»¥é€šè¿‡å•ä¸ªæ¬§æ‹‰æ­¥éª¤é‡‡æ ·ã€‚

$$
\frac{d}{dt} \Psi  _t(x)=u_t(\Psi _t(x))
$$

$$
â„’_{CFM}(Î¸) = \mathbb{E}D(u^Î¸_t (X_t),u_t(X_t|X_1))
$$

> D æ˜¯ä¸€ä¸ª Bregman æ•£åº¦ï¼ŒL2 Loss æ˜¯å…¶ä¸­ä¸€ç§ï¼Œæ ¹æ®ä¸Šæ–‡ä¸­ \\(Ïˆ _t\\) çš„å®šä¹‰ï¼ŒæŠŠL2 å’Œæ¡ä»¶é€Ÿåº¦ä»£å…¥å…¬å¼å¾—ï¼šå¯¹äºç‰¹å®šçš„ \\(X_0\\) å’Œ \\(X_1\\) ï¼Œ \\(X_1-X_0\\) æ˜¯æ¡ä»¶è·¯å¾„çš„æ¡ä»¶é€Ÿåº¦ã€‚   

$$
â„’_{CFM}(Î¸) = \mathbb{E}||u^Î¸_t (X_t)-(X_1-X_0)||^ 2 
$$

å› æ­¤ï¼Œè¿™ä¸ªç®—æ³•æ˜¯ç‰¹å®šæ¡ä»¶æµ + ç‰¹å®š Loss ä¸‹çš„ä¸€ä¸ª flow matching å®ä¾‹ã€‚   

P30    
### Affine paths

> åœ¨å‰é¢çš„æ–¹æ³•ä¸­ï¼Œ\\(Ïˆ_t(x|x_1)\\) æ˜¯ \\(x\\) ä¸ \\(x_1\\) çš„çº¿æ€§ç»„åˆï¼Œè¿™åªæ˜¯ä¸€ç§é€‰æ‹©ã€‚ç°åœ¨å‡è®¾å…¶ä¸ºä»¿å°„ç»„åˆã€‚  

![](../assets/P30å›¾1.png)    
  
è¿™ç§æƒ…å†µä¸‹ï¼Œ\\(X_0\\) åˆ° \\(X_1\\) ä¸å†æ˜¯ç›´çº¿ã€‚    
ç”±æ­¤å¾—åˆ°ä¸åŒçš„å‚æ•°åŒ–é€Ÿåº¦çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š      
(1) \\(u_t(x)=\frac{d\psi t}{dt}\\) ï¼Œç›´æ¥é¢„æµ‹é€Ÿåº¦    

![](../assets/P30å›¾2-1.png) 

(2) æºé¢„æµ‹ï¼šé€šè¿‡ \\(X_0\\) çš„æ¡ä»¶æœŸæœ›æ¥å‚æ•°åŒ–é€Ÿåº¦ã€‚é¢„æµ‹ \\(X_0\\) ï¼Œå†è½¬åŒ–ä¸º \\(x\\) çš„é€Ÿåº¦     

![](../assets/P30å›¾2-2.png)     

(3) ç›®æ ‡é¢„æµ‹ç±»ä¼¼ï¼Œé¢„æµ‹ \\(X_1\\) ï¼Œå†è½¬åŒ–ä¸º \\(x\\)çš„é€Ÿåº¦       
![](../assets/P30å›¾2-3.png)  

æ ¹æ® \\(\alpha _t\\) å’Œ \\(\sigma _t\\) çš„å®šä¹‰ä¸åŒï¼Œæ¨å¯¼å‡ºçš„ \\(a_t,b_t,c_t,d_t\\) ä¸åŒã€‚    
ä»¥ä¸Šå…¬å¼ä¸­çš„â€œæœŸæœ›â€éƒ¨åˆ†ï¼Œéƒ½æ˜¯ç½‘ç»œè¦é¢„æµ‹çš„éƒ¨åˆ†ã€‚é¢„æµ‹çš„å†…å®¹ä¸åŒï¼Œæœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸ºäº†æ±‚ \\(x\\) çš„é€Ÿåº¦ã€‚    

P31    
### Gaussian paths   

> ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰å¯¹æºåˆ†å¸ƒ \\(P\\) å’Œç›®æ ‡åˆ†å¸ƒ \\(Q\\) åšä»»ä½•å‡è®¾ã€‚    
å¦‚æœå‡è®¾ \\(P\\) æ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œ\\(P\\) å’Œ \\(Q\\) æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å³ä¸ diffusion çš„ ODE è¿‡ç¨‹å»åˆã€‚

$$
p(x) = ğ’©(x |0 , I) \quad  Ï€_{0,1}(x_0, x_1) = p(x_0)q(x_1)
$$

![](../assets/P31å›¾.png)    

> diffusion çš„å™ªå£°é¢„æµ‹ï¼Œåœ¨ \\(x\\) æ¥è¿‘å™ªå£°æ—¶(åˆå§‹ steps)ä¼šæœ‰å¥‡å¼‚æ€§é—®é¢˜ã€‚   

P32   ã€€
### Affine and Gaussian paths    

#### å‚æ•°æ¯”è¾ƒ

![](../assets/P32å›¾-1.png)    

> è“è‰²éƒ¨åˆ†é€‚ç”¨äºæ‰€æœ‰çš„ä»¿å°„è·¯å¾„(åŒ…æ‹¬é«˜æ–¯ path)ã€‚ç²‰è‰²éƒ¨åˆ†ä»…é€‚ç”¨äºé«˜æ–¯ path.     
[&#x2753;] è¡¨æ ¼æ€ä¹ˆçœ‹ï¼Ÿ    

P33     

![](../assets/P33å›¾.png)    
  
> flow matching ä¸ç¡®å®šæ€§ diffusion ä¹‹é—´çš„å…³ç³»:   
1.diffusion é€šè¿‡å®šä¹‰ forward process ç„¶åå†åè½¬æ¥ç”Ÿæˆæ¦‚ç‡è·¯å¾„ã€‚    
flow matching é€šè¿‡å°†æ‰€æœ‰å·²çŸ¥çš„æ¡ä»¶æ¦‚ç‡è·¯å¾„çš„èšåˆæ¥ç”Ÿæˆæ¦‚ç‡è·¯å¾„ã€‚    
2.diffusion æ„é€ äº† forward prossessï¼Œéœ€è¦ä¸€ä¸ªæ ¹æ® forward process æ„é€ æ¡ä»¶æ¦‚ç‡çš„é—­å¼è§£ï¼Œå› æ­¤ä¼šè¦æ±‚ \\(P\\) æ˜¯é«˜æ–¯ï¼Œä¸” \\(P\\) å’Œ \\(Q\\) ç‹¬ç«‹ã€‚    
flow matching æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ï¼Œ\\(P\\) å’Œ \\(Q\\) å¯ä»¥æ˜¯ä»»æ„çš„åˆ†å¸ƒã€‚

 


---------------------------------------
> æœ¬æ–‡å‡ºè‡ªCaterpillarStudyGroupï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
>
> https://caterpillarstudygroup.github.io/ImportantArticles/






    

  